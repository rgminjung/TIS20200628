<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Document</title>

        <!-- Latest compiled and minified CSS -->
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        />

        <!-- CSS import -->
        <link rel="stylesheet" href="../css/reset.css" />
        <style>
            .strong {
                color: red;
                font-weight: bold;
                font-size: 1.2em;
            }
            label {
                display: inline-block;
                width: 80px;
            }
            #app > div {
                margin: 5px 0;
            }
        </style>
    </head>
    <body>
        <pre>
        CRUD 방법을 학습한다.

        Object Array 에서 최대값 구하는 방법은 구글 검색을 이용한다.
        ==> 검색조건: javascript object array max
        방법1. .map() 를 사용하는 방법
        방법2. .reducer()
    </pre
        >
        <hr />
        <div id="app"></div>
    </body>
</html>

<!-- react 플러그인 include   -->
<!-- 주의: 사이트를 배포할 때는 "development.js"를 "production.min.js"로 대체하세요. -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.12.0/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.11.0/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
<script type="text/babel">
    console.log(React);
    console.log(ReactDOM);

    class CrudListItem extends React.Component {
        render() {
            const { id, name, power } = this.props.man;

            return (
                <tr className="" key={id}>
                    <td>{id}</td>
                    <td>{name}</td>
                    <td>{power}</td>
                    <td>
                        <button>Del</button>
                        <button>Power Up</button>
                        <button>Power Down</button>
                        <button>Edit</button>
                    </td>
                </tr>
            );
        }
    }

    class CrudList extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            const rows = this.props.list;
            /*{items.map(function (value, key) {
                return <li key={key}>{value}</li>;
                        })}
                        */
            const trs = rows.map(function (man, index) {
                return <CrudListItem man={man} key={man.id}></CrudListItem>;
            });
            return (
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NAME</th>
                            <th>POWER</th>
                            <th>CRUD</th>
                        </tr>
                    </thead>
                    <tbody>{trs}</tbody>
                </table>
            );
        }
    }

    class CrudInput extends React.Component {
        constructor(props) {
            super(props);
            this.insert = this.insert.bind(this);
        }
        insert(event) {
            //이벤트 핸들러 this bind
            //부모(CrudApp)에게 값을 넘김
            const user = {
                name: "aaa",
                power: 10000,
            };
            this.props.insert(user);
        }
        render() {
            return (
                <div>
                    <h1>Creat Read Update Delete</h1>
                    <div>
                        <label htmlFor="">Name : </label> <input type="text" />
                    </div>
                    <div>
                        <label htmlFor="">Power : </label> <input type="text" />
                    </div>
                    <button onClick={this.insert}>Add</button>
                    <hr />
                </div>
            );
        }
    }

    class CrudApp extends React.Component {
        state = {
            list: [
                { id: 1, name: "슈퍼맨", power: 100 },
                { id: 2, name: "아쿠아맨", power: 300 },
                { id: 3, name: "스파이더맨", power: 500 },
                { id: 4, name: "배트맨", power: 30 },
            ],
        };
        constructor(props) {
            super(props);
            //this bind
            this.insert = this.insert.bind(this);
        }
        insert(user) {
            //이벤트 콜백 this bind
            //this.state.list에 추가

            var maxObj = this.$data.list.reduce(function (prev, next) {
                return prev.id > next.id ? prev : next;
            });
            console.log(maxObj);

            if (maxObj) {
                // user 객체 id 프러퍼티와 값 추가
                // user = {name:?, power: ? }
                user.id = maxObj.id + 1; // {eid:?, name:?, power: ? }
            } else {
                user.id = 1;
            }

            //신규 리스트 생성 ...this.state.list 기존 리스트 총row
            const listCopy = [...this.state.list, user];
            this.setState({
                list: listCopy,
            });
        }

        render() {
            return (
                <div>
                    <CrudInput></CrudInput>
                    <CrudList {...this.state}></CrudList>
                </div>
            );
        }
    }

    ReactDOM.render(<CrudApp></CrudApp>, document.getElementById("app"));
</script>
